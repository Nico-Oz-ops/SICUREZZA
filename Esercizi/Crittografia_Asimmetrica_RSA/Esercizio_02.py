'''
modulus:
    00:b0:62:98:c4:8d:63:fb:1c:48:97:23:71:d0:04:
    a9:02:4a:e3:2b:c6:ad:22:00:88:7e:e4:e7:91:0d:
    98:32:1a:ea:09:d0:ea:c5:71:44:f0:1a:bb:3a:69:
    70:94:21:bc:b4:9b:25:46:a0:90:9c:e8:4f:92:21:
    e2:2b:af:a8:e8:45:13:e4:dd:90:a0:49:d4:65:93:
    64:55:16:8f:89:c7:25:0d:3a:23:d4:e8:7a:97:4a:
    25:ef:bc:d9:40:6e:b2:be:23:17:3b:01:c6:31:6b:
    e1:0f:bd:52:4e:07:64:9c:11:ab:1b:ea:77:4d:29:
    33:57:ea:ba:67:c7:b8:09:f1:eb:58:c6:d6:80:12:
    bf:7a:3a:51:e8:62:02:ab:5c:05:66:46:4f:1e:b9:
    f7:03:9b:80:1f:15:3d:76:9a:5a:9a:57:a1:38:b3:
    49:6a:c4:6b:6a:e2:01:ff:15:73:a2:b8:8c:85:57:
    d4:f8:cd:f6:09:5d:dc:e9:da:b4:29:87:c3:57:33:
    ad:a7:b5:ec:b7:48:ce:4e:d7:e6:74:ff:9f:bf:ff:
    ec:45:ad:96:14:bb:b6:c2:c1:91:62:7c:dc:5e:58:
    b2:58:96:fb:01:e4:8a:f5:cf:10:1b:32:a1:ae:53:
    b1:da:cb:79:f7:f9:bf:21:4f:51:d0:8c:ad:b5:28:
    c6:37
publicExponent: 3 (0x3)
privateExponent:
    1d:65:c4:20:c2:3b:54:84:b6:c3:db:3d:a2:ab:71:
    80:61:d0:87:4b:c7:85:aa:c1:6a:7b:7b:ed:82:44:
    08:59:d1:ac:4d:7c:76:3d:8b:7d:59:c9:df:11:92:
    c3:5a:f4:c8:c4:86:36:70:18:1a:26:b7:ed:b0:50:
    5c:9d:46:d1:60:d8:a6:24:ed:70:0c:4e:10:ed:e6:
    0e:2e:6d:41:a1:30:d7:89:b0:a3:7c:14:6e:8c:5b:
    a7:f4:ce:e0:12:73:1f:b0:83:df:2a:f6:5d:91:fa:
    d7:f4:e3:0d:01:3b:6f:58:47:2f:51:be:8c:dc:33:
    39:51:c9:bb:f6:9e:ac:52:b5:30:cc:2c:d5:fd:88:
    d8:37:9b:fa:6f:41:d5:56:fe:6e:15:10:36:79:77:
    f2:3a:35:c4:ba:eb:88:65:48:a0:67:07:08:06:9b:
    ca:f2:3e:72:e4:f3:a9:46:15:be:01:9c:31:4d:8a:
    96:aa:87:64:34:64:cd:d5:99:4b:36:d9:88:6c:2e:
    61:40:26:b9:48:b8:26:65:26:47:aa:2d:49:e0:7d:
    60:b6:bf:d8:6e:97:27:0c:fb:e8:0e:7d:08:51:6c:
    9b:3a:09:e6:d9:cb:09:68:49:bb:14:b4:96:c1:0c:
    ad:ed:97:57:9b:1f:ff:67:6f:fc:54:de:92:ed:fb:
    13

messaggio = "Ciao gente, come state? Allerta di cioccolato!"
'''

modulus = '''
    00:b0:62:98:c4:8d:63:fb:1c:48:97:23:71:d0:04:
    a9:02:4a:e3:2b:c6:ad:22:00:88:7e:e4:e7:91:0d:
    98:32:1a:ea:09:d0:ea:c5:71:44:f0:1a:bb:3a:69:
    70:94:21:bc:b4:9b:25:46:a0:90:9c:e8:4f:92:21:
    e2:2b:af:a8:e8:45:13:e4:dd:90:a0:49:d4:65:93:
    64:55:16:8f:89:c7:25:0d:3a:23:d4:e8:7a:97:4a:
    25:ef:bc:d9:40:6e:b2:be:23:17:3b:01:c6:31:6b:
    e1:0f:bd:52:4e:07:64:9c:11:ab:1b:ea:77:4d:29:
    33:57:ea:ba:67:c7:b8:09:f1:eb:58:c6:d6:80:12:
    bf:7a:3a:51:e8:62:02:ab:5c:05:66:46:4f:1e:b9:
    f7:03:9b:80:1f:15:3d:76:9a:5a:9a:57:a1:38:b3:
    49:6a:c4:6b:6a:e2:01:ff:15:73:a2:b8:8c:85:57:
    d4:f8:cd:f6:09:5d:dc:e9:da:b4:29:87:c3:57:33:
    ad:a7:b5:ec:b7:48:ce:4e:d7:e6:74:ff:9f:bf:ff:
    ec:45:ad:96:14:bb:b6:c2:c1:91:62:7c:dc:5e:58:
    b2:58:96:fb:01:e4:8a:f5:cf:10:1b:32:a1:ae:53:
    b1:da:cb:79:f7:f9:bf:21:4f:51:d0:8c:ad:b5:28:
    c6:37
'''

privateExponent = '''
    1d:65:c4:20:c2:3b:54:84:b6:c3:db:3d:a2:ab:71:
    80:61:d0:87:4b:c7:85:aa:c1:6a:7b:7b:ed:82:44:
    08:59:d1:ac:4d:7c:76:3d:8b:7d:59:c9:df:11:92:
    c3:5a:f4:c8:c4:86:36:70:18:1a:26:b7:ed:b0:50:
    5c:9d:46:d1:60:d8:a6:24:ed:70:0c:4e:10:ed:e6:
    0e:2e:6d:41:a1:30:d7:89:b0:a3:7c:14:6e:8c:5b:
    a7:f4:ce:e0:12:73:1f:b0:83:df:2a:f6:5d:91:fa:
    d7:f4:e3:0d:01:3b:6f:58:47:2f:51:be:8c:dc:33:
    39:51:c9:bb:f6:9e:ac:52:b5:30:cc:2c:d5:fd:88:
    d8:37:9b:fa:6f:41:d5:56:fe:6e:15:10:36:79:77:
    f2:3a:35:c4:ba:eb:88:65:48:a0:67:07:08:06:9b:
    ca:f2:3e:72:e4:f3:a9:46:15:be:01:9c:31:4d:8a:
    96:aa:87:64:34:64:cd:d5:99:4b:36:d9:88:6c:2e:
    61:40:26:b9:48:b8:26:65:26:47:aa:2d:49:e0:7d:
    60:b6:bf:d8:6e:97:27:0c:fb:e8:0e:7d:08:51:6c:
    9b:3a:09:e6:d9:cb:09:68:49:bb:14:b4:96:c1:0c:
    ad:ed:97:57:9b:1f:ff:67:6f:fc:54:de:92:ed:fb:
    13
'''

e = 3 # esponente pubblico
n_hex_pulito =  modulus.replace(":", "").replace(" ", "").replace("\n", "")
n = int(n_hex_pulito, 16) # modulo


d_hex_pulito = privateExponent.replace(":", "").replace(" ", "").replace("\n", "")
d = int(d_hex_pulito, 16) # esponente privato


# Convertire ogni carattere in byte e poi in interi

messaggio = "Ciao gente, come state? Allerta di cioccolato!"

def str_to_num(stringa: str):
    totale = 0
    esp = 0

    for carattere in stringa[::-1]:
        totale += 256 ** esp * ord(carattere)
        esp += 1
    
    return totale

M = str_to_num(messaggio)
print(M)

# Cifrare
cifra = pow(M, e, n)

# Decifrare
decifra = pow(cifra, d, n)


# Riconvertire in stringa

def num_to_str(num: int):
    caratteri = []

    while num > 0:
        caratteri.append(chr(num % 256))
        num = num // 256
    
    return ''.join(caratteri[::-1])

decifra_msg = num_to_str(decifra)
print(decifra_msg)

try:
    if decifra_msg == messaggio:
        print("Super! Messaggi coincidono")
        print(f"Messaggio originale: {messaggio}")
        print(f"Messaggio decifrato: {decifra_msg}")
    
    else:
        print("Peccato i messaggi non coincidono")

except ValueError as e:
    print(f"Errore: {e}")


